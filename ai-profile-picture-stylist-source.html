<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Profile Picture Stylist - Source Code</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            color: #222;
            background-color: #ffffff;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .back-nav {
            margin-bottom: 20px;
        }

        .back-nav a {
            color: #007BFF;
            text-decoration: none;
            font-size: 1rem;
        }

        .back-nav a:hover {
            text-decoration: underline;
        }

        .project-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 0;
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
            border-radius: 10px;
        }

        .project-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .project-header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .badges {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .badge {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
        }

        .content-section {
            margin: 40px 0;
            padding: 30px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border-left: 5px solid #2196F3;
        }

        .content-section h2 {
            color: #2196F3;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }

        .content-section h3 {
            color: #333;
            margin: 20px 0 10px 0;
            font-size: 1.3rem;
        }

        .highlight-box {
            background: linear-gradient(135deg, #FFF8E1, #FFF3C4);
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #2196F3;
            margin: 20px 0;
        }

        .code-container {
            background-color: #1e1e1e;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
        }

        .code-header {
            color: #569cd6;
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 1.1rem;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
        }

        .code-block {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            color: #d4d4d4;
        }

        .code-comment {
            color: #6a9955;
            font-style: italic;
        }

        .code-keyword {
            color: #569cd6;
        }

        .code-string {
            color: #ce9178;
        }

        .code-function {
            color: #dcdcaa;
        }

        .code-number {
            color: #b5cea8;
        }

        .demo-links {
            text-align: center;
            margin: 30px 0;
        }

        .demo-btn {
            display: inline-block;
            background-color: #007BFF;
            color: white;
            padding: 12px 25px;
            text-decoration: none;
            border-radius: 5px;
            margin: 0 10px;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .demo-btn:hover {
            background-color: #0056b3;
        }

        .demo-btn.secondary {
            background-color: #28a745;
        }

        .demo-btn.secondary:hover {
            background-color: #218838;
        }

        @media (max-width: 768px) {
            .project-header h1 {
                font-size: 2rem;
            }

            .project-header p {
                font-size: 1rem;
            }

            .demo-btn {
                margin: 5px;
                padding: 10px 20px;
            }

            .container {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <nav class="back-nav">
            <a href="ai-profile-picture-stylist.html">‚Üê Back to Project Overview</a>
        </nav>

        <div class="project-header">
            <h1>üé® AI Profile Picture Stylist</h1>
            <p>Core Source Code & Professional Image Styling Implementation</p>

            <div class="badges">
                <span class="badge">React 19</span>
                <span class="badge">TypeScript</span>
                <span class="badge">Google Gemini AI</span>
                <span class="badge">Image Processing</span>
            </div>
        </div>

        <div class="highlight-box">
            <h3>üîç About This Code Showcase</h3>
            <p><strong>This curated code snippet demonstrates how the AI Profile Picture Stylist processes uploaded images, validates people count, and generates professional styling variations using Google Gemini's advanced image capabilities.</strong></p>
            <p>Full deployment scripts, API integrations, and proprietary details are omitted for clarity and security. This showcase highlights the core image processing and AI-powered professional styling algorithms.</p>
        </div>

        <div class="content-section">
            <h2>üñºÔ∏è Core Algorithm: Professional Image Styling Engine</h2>
            <p>The foundation of the AI Profile Picture Stylist is its ability to intelligently analyze uploaded images, detect people count, and generate professional styling variations optimized for business contexts:</p>

            <div class="code-container">
                <div class="code-header">ü§ñ geminiService.ts</div>
                <div class="code-block">
<span class="code-keyword">import</span> { GoogleGenAI, Modality, GenerateContentResponse, Type } <span class="code-keyword">from</span> <span class="code-string">"@google/genai"</span>;
<span class="code-keyword">import</span> { getPrompts } <span class="code-keyword">from</span> <span class="code-string">'../constants'</span>;
<span class="code-keyword">import</span> { GeneratedImage } <span class="code-keyword">from</span> <span class="code-string">'../types'</span>;

<span class="code-comment">// Initialize Google Gemini AI with secure API key</span>
<span class="code-keyword">const</span> ai = <span class="code-keyword">new</span> GoogleGenAI({ apiKey: process.env.API_KEY });

<span class="code-comment">/**
 * Advanced people detection using Google Gemini's vision capabilities
 * Analyzes image content to count people with high accuracy for validation
 */</span>
<span class="code-keyword">export</span> <span class="code-keyword">async</span> <span class="code-keyword">function</span> <span class="code-function">countPeopleInImage</span>(imagePreviewUrl: <span class="code-keyword">string</span>): Promise&lt;<span class="code-keyword">number</span>&gt; {
    <span class="code-comment">// Extract MIME type and base64 data from image URL</span>
    <span class="code-keyword">const</span> mimeTypeMatch = imagePreviewUrl.match(<span class="code-string">/data:(image\/\w+);base64,/</span>);
    <span class="code-keyword">if</span> (!mimeTypeMatch) {
        <span class="code-keyword">throw</span> <span class="code-keyword">new</span> Error(<span class="code-string">"Invalid image data URL."</span>);
    }
    <span class="code-keyword">const</span> mimeType = mimeTypeMatch[<span class="code-number">1</span>];
    <span class="code-keyword">const</span> base64Image = imagePreviewUrl.split(<span class="code-string">','</span>)[<span class="code-number">1</span>];

    <span class="code-comment">// Prepare image for Gemini AI processing</span>
    <span class="code-keyword">const</span> imagePart = {
        inlineData: {
            data: base64Image,
            mimeType: mimeType,
        },
    };

    <span class="code-comment">// Specialized prompt for accurate people counting with JSON schema</span>
    <span class="code-keyword">const</span> textPart = {
        text: <span class="code-string">'Analyze the image and count the number of people visible. Respond with only a JSON object containing a single key "personCount" with a numerical value.'</span>,
    };

    <span class="code-keyword">try</span> {
        <span class="code-comment">// Use Gemini 2.5 Flash with structured JSON output for reliability</span>
        <span class="code-keyword">const</span> response: GenerateContentResponse = <span class="code-keyword">await</span> ai.models.generateContent({
            model: <span class="code-string">'gemini-2.5-flash'</span>,
            contents: { parts: [imagePart, textPart] },
            config: {
                responseMimeType: <span class="code-string">'application/json'</span>,
                responseSchema: {
                    type: Type.OBJECT,
                    properties: {
                        personCount: {
                            type: Type.NUMBER,
                            description: <span class="code-string">'The number of people in the image.'</span>
                        }
                    }
                }
            }
        });

        <span class="code-comment">// Parse and validate the structured response</span>
        <span class="code-keyword">const</span> jsonString = response.text;
        <span class="code-keyword">const</span> result = JSON.parse(jsonString);

        <span class="code-keyword">if</span> (<span class="code-keyword">typeof</span> result.personCount === <span class="code-string">'number'</span>) {
            <span class="code-keyword">return</span> result.personCount;
        } <span class="code-keyword">else</span> {
            <span class="code-keyword">throw</span> <span class="code-keyword">new</span> Error(<span class="code-string">'Invalid response format from person counting API.'</span>);
        }

    } <span class="code-keyword">catch</span> (error) {
        console.error(<span class="code-string">'Error counting people in image:'</span>, error);
        <span class="code-keyword">throw</span> <span class="code-keyword">new</span> Error(<span class="code-string">'Failed to analyze the image content.'</span>);
    }
}

<span class="code-comment">/**
 * Professional image style generation using Gemini's multimodal capabilities
 * Creates single styled image with specialized prompts for business contexts
 */</span>
<span class="code-keyword">async</span> <span class="code-keyword">function</span> <span class="code-function">generateSingleStyledImage</span>(base64Image: <span class="code-keyword">string</span>, mimeType: <span class="code-keyword">string</span>, prompt: <span class="code-keyword">string</span>): Promise&lt;<span class="code-keyword">string</span>&gt; {
    <span class="code-keyword">const</span> imagePart = {
        inlineData: {
            data: base64Image,
            mimeType: mimeType,
        },
    };

    <span class="code-keyword">const</span> textPart = {
        text: prompt,
    };

    <span class="code-keyword">try</span> {
        <span class="code-comment">// Use Gemini 2.5 Flash Image Preview for high-quality image generation</span>
        <span class="code-keyword">const</span> response: GenerateContentResponse = <span class="code-keyword">await</span> ai.models.generateContent({
            model: <span class="code-string">'gemini-2.5-flash-image-preview'</span>,
            contents: {
                parts: [imagePart, textPart],
            },
            config: {
                responseModalities: [Modality.IMAGE, Modality.TEXT],
            },
        });

        <span class="code-comment">// Extract image data from multimodal response</span>
        <span class="code-keyword">const</span> imagePartResponse = response.candidates?.[<span class="code-number">0</span>]?.content?.parts?.find(part => part.inlineData);

        <span class="code-keyword">if</span> (imagePartResponse?.inlineData) {
            <span class="code-keyword">const</span> base64ImageBytes: <span class="code-keyword">string</span> = imagePartResponse.inlineData.data;
            <span class="code-keyword">return</span> `data:${imagePartResponse.inlineData.mimeType};base64,${base64ImageBytes}`;
        } <span class="code-keyword">else</span> {
            <span class="code-comment">// Handle safety filtering and content policy blocks</span>
            <span class="code-keyword">const</span> safetyRatings = response.candidates?.[<span class="code-number">0</span>]?.safetyRatings;
            <span class="code-keyword">if</span> (safetyRatings && safetyRatings.some(r => r.probability !== <span class="code-string">'NEGLIGIBLE'</span>)) {
                console.error(<span class="code-string">"Image generation blocked due to safety ratings:"</span>, safetyRatings);
                <span class="code-keyword">throw</span> <span class="code-keyword">new</span> Error(<span class="code-string">"The image could not be generated due to safety policies. Please try a different photo."</span>);
            }
            console.error(<span class="code-string">"No image data in response:"</span>, response);
            <span class="code-keyword">throw</span> <span class="code-keyword">new</span> Error(<span class="code-string">'No image data found in the API response.'</span>);
        }
    } <span class="code-keyword">catch</span> (error) {
        console.error(<span class="code-string">'Error generating image with Gemini:'</span>, error);
        <span class="code-keyword">throw</span> <span class="code-keyword">new</span> Error(<span class="code-string">'Failed to communicate with the image generation service.'</span>);
    }
}
                </div>
            </div>
        </div>

        <div class="content-section">
            <h2>üé® Advanced Professional Styling System</h2>
            <p>The styling system uses carefully engineered prompts optimized for professional business contexts, generating four distinct styles that maintain facial features while adapting pose and presentation:</p>

            <div class="code-container">
                <div class="code-header">üìù constants.ts - Professional Style Engine</div>
                <div class="code-block">
<span class="code-keyword">import</span> { StyleDefinition } <span class="code-keyword">from</span> <span class="code-string">'./types'</span>;

<span class="code-comment">/**
 * Dynamic prompt generation system that adapts to person count
 * Creates specialized prompts for optimal professional results
 */</span>
<span class="code-keyword">export</span> <span class="code-keyword">const</span> <span class="code-function">getPrompts</span> = (personCount: <span class="code-keyword">number</span>): StyleDefinition[] => {
    <span class="code-comment">// Smart language adaptation based on person count</span>
    <span class="code-keyword">const</span> subject = personCount === <span class="code-number">2</span> ? <span class="code-string">"the two people"</span> : <span class="code-string">"the person"</span>;
    <span class="code-keyword">const</span> possessive = personCount === <span class="code-number">2</span> ? <span class="code-string">"their"</span> : <span class="code-string">"the person's"</span>;
    <span class="code-keyword">const</span> subjectCapitalized = personCount === <span class="code-number">2</span> ? <span class="code-string">"The two people"</span> : <span class="code-string">"The person"</span>;

    <span class="code-comment">// Foundation prompt ensuring consistency across all styles</span>
    <span class="code-keyword">const</span> BASE_PROMPT = `Using the provided photo, generate a new profile image. Retain ${subject}'s core facial features and clothing but adjust ${possessive} pose, expression, and body language to fit the specified style. The final image must be a high-resolution photo in a 1:1 aspect ratio with a plain studio background. ${subjectCapitalized} should look natural and authentic.`;

    <span class="code-keyword">return</span> [
        {
            id: <span class="code-string">'classic-bw'</span>,
            title: <span class="code-string">'Classic Black & White'</span>,
            description: <span class="code-string">'A refined, timeless, and professional portrait in high-resolution black and white.'</span>,
            prompt: `${BASE_PROMPT} The style is 'Classic Black & White Elegance'. Create a high-resolution black-and-white portrait. ${subjectCapitalized} should have a classic, poised portrait posture‚Äîshoulders slightly angled, back straight, with a calm and composed demeanor. The background should be a soft, gray gradient studio background. The lighting must be even and flattering, highlighting facial features and hair texture without any harsh shadows. The face should appear clean, detailed, and natural‚Äîdo not apply heavy filters. Ensure the eyes are bright and expressive, with a subtle, genuine smile. The overall atmosphere must feel refined, timeless, and professional.`
        },
        {
            id: <span class="code-string">'corporate'</span>,
            title: <span class="code-string">'Corporate Executive'</span>,
            description: <span class="code-string">'A crisp, detailed, and confident portrait suitable for LinkedIn or company websites.'</span>,
            prompt: `${BASE_PROMPT} The style is 'Corporate Executive Portrait', inspired by Apple's executive headshots. Adjust ${possessive} pose to be confident and professional, either seated or standing. The posture should be open and relaxed with a slight lean forward to convey engagement and focus. Hand gestures, if visible, should be natural and professional (e.g., gently clasped). The background must be plain light gray or white. The lighting should be soft and balanced, creating smooth transitions with no deep shadows. The expression must be approachable and confident, with a subtle hint of a smile. The final image should be crisp, detailed, and professional.`
        },
        {
            id: <span class="code-string">'lifestyle'</span>,
            title: <span class="code-string">'Natural Lifestyle'</span>,
            description: <span class="code-string">'An honest, approachable, and warm portrait with soft, natural-looking light.'</span>,
            prompt: `${BASE_PROMPT} The style is 'Natural Lifestyle Portrait'. The pose should be relaxed and natural, as if caught in a candid moment. Avoid stiff or formal postures; instead, aim for a slight head tilt or a genuine, soft smile to create a sense of authenticity. The body language must be open and inviting. The background must be a clean, plain, neutral-colored studio background. Recreate the scene with soft, daylight-style studio lighting, as if illuminated by morning or gentle afternoon sun. This light should gently define the face's natural contours while keeping the mood bright and open. ${possessive} expression should be relaxed, friendly, and warm. The overall effect should be honest, approachable, and simple.`
        },
        {
            id: <span class="code-string">'editorial'</span>,
            title: <span class="code-string">'Modern Editorial'</span>,
            description: <span class="code-string">'A creative, polished, and visually striking portrait with a modern, magazine-like quality.'</span>,
            prompt: `${BASE_PROMPT} The style is 'Modern Editorial'. The pose should be stylish and dynamic, inspired by fashion editorials‚Äîcomposed but not rigid. It could be a confident standing pose or a thoughtful seated one, conveying quiet confidence and elegance. The background must be a plain, minimalist studio setting with subtle directional lighting that adds depth and character. The clothing should appear stylish yet simple, with clean lines. The atmosphere should have a contemporary, slightly dreamy feel, enhanced by a soft focus and a shallow depth of field. ${possessive} expression must be elegant and composed, with a modern, magazine-like quality. The final image should look creative, polished, and visually striking while remaining natural.`
        }
    ];
};
                </div>
            </div>
        </div>

        <div class="content-section">
            <h2>üöÄ Batch Processing & Error Handling System</h2>
            <p>The application implements sophisticated concurrent processing to generate all four professional styles simultaneously while maintaining robust error handling for production reliability:</p>

            <div class="code-container">
                <div class="code-header">‚ö° generateStyledImages - Concurrent Processing Engine</div>
                <div class="code-block">
<span class="code-comment">/**
 * Main style generation orchestrator - processes all 4 styles concurrently
 * Implements resilient error handling for production-grade reliability
 */</span>
<span class="code-keyword">export</span> <span class="code-keyword">const</span> <span class="code-function">generateStyledImages</span> = <span class="code-keyword">async</span> (imagePreviewUrl: <span class="code-keyword">string</span>, personCount: <span class="code-keyword">number</span>): Promise&lt;GeneratedImage[]&gt; => {
    <span class="code-comment">// Validate and extract image data</span>
    <span class="code-keyword">const</span> mimeTypeMatch = imagePreviewUrl.match(<span class="code-string">/data:(image\/\w+);base64,/</span>);
    <span class="code-keyword">if</span> (!mimeTypeMatch) {
        <span class="code-keyword">throw</span> <span class="code-keyword">new</span> Error(<span class="code-string">"Invalid image data URL."</span>);
    }
    <span class="code-keyword">const</span> mimeType = mimeTypeMatch[<span class="code-number">1</span>];
    <span class="code-keyword">const</span> base64Image = imagePreviewUrl.split(<span class="code-string">','</span>)[<span class="code-number">1</span>];

    <span class="code-comment">// Get dynamic prompts optimized for person count</span>
    <span class="code-keyword">const</span> STYLES = getPrompts(personCount);

    <span class="code-comment">// Concurrent processing: Generate all 4 styles simultaneously for optimal performance</span>
    <span class="code-keyword">const</span> imagePromises = STYLES.map(style =>
        generateSingleStyledImage(base64Image, mimeType, style.prompt)
            .then(src => ({ ...style, src }))
            .catch(error => {
                console.error(`Failed to generate style ${style.title}:`, error);
                <span class="code-comment">// Graceful degradation: Return placeholder for failed generations</span>
                <span class="code-keyword">return</span> { ...style, src: <span class="code-string">''</span>, error: `Failed to generate: ${error.message}` };
            })
    );

    <span class="code-comment">// Wait for all concurrent operations and filter successful results</span>
    <span class="code-keyword">const</span> results = <span class="code-keyword">await</span> Promise.all(imagePromises);

    <span class="code-comment">// Return only successfully generated images for user display</span>
    <span class="code-keyword">return</span> results.filter(result => result.src);
};
                </div>
            </div>
        </div>

        <div class="content-section">
            <h2>‚öôÔ∏è Technical Implementation Notes</h2>
            <h3>Key Algorithms & Innovations</h3>
            <ul style="margin: 15px 0; padding-left: 20px;">
                <li><strong>Smart People Detection:</strong> JSON-structured responses ensure reliable person counting for optimal results</li>
                <li><strong>Dynamic Prompt Engineering:</strong> Contextual prompt adaptation based on person count (1 vs 2 people)</li>
                <li><strong>Multimodal AI Processing:</strong> Leverages Gemini 2.5 Flash's advanced image generation capabilities</li>
                <li><strong>Concurrent Style Generation:</strong> All 4 professional styles generated simultaneously for optimal performance</li>
                <li><strong>Production Error Handling:</strong> Graceful degradation with safety filtering and content policy compliance</li>
            </ul>

            <h3>Why This Approach Works</h3>
            <ul style="margin: 15px 0; padding-left: 20px;">
                <li><strong>Business-Ready Output:</strong> Each style optimized for professional contexts like LinkedIn and corporate websites</li>
                <li><strong>Facial Feature Preservation:</strong> Advanced prompting maintains identity while transforming presentation</li>
                <li><strong>Quality Assurance:</strong> Multiple validation steps ensure professional-grade results</li>
                <li><strong>Scalable Architecture:</strong> Concurrent processing supports high-volume usage patterns</li>
            </ul>
        </div>

        <div class="demo-links">
            <a href="https://ai-profile-picture-stylist-662370080553.us-west1.run.app/" target="_blank" class="demo-btn">üöÄ Try Live Demo</a>
            <a href="ai-profile-picture-stylist.html" class="demo-btn secondary">üìñ View Full Project Details</a>
        </div>

        <nav class="back-nav" style="text-align: center; margin-top: 40px;">
            <a href="index.html">‚Üê Back to Portfolio</a> |
            <a href="ai-profile-picture-stylist.html">View Project Overview</a>
        </nav>
    </div>
</body>
</html>