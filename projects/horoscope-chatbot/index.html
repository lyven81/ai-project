<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: system-ui, Arial, sans-serif;
            background-color: #ffffff;
            padding: 20px;
            line-height: 1.6;
            color: #222;
        }

        .container {
            max-width: 720px;
            margin: 0 auto;
            background: #f9f9f9;
            padding: 16px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 16px;
        }

        .header h1 {
            font-size: 2rem;
            color: #333;
            margin-bottom: 8px;
        }

        .header p {
            color: #666;
            font-size: 0.95rem;
        }

        .form-group {
            margin-bottom: 16px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #333;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
            transition: border-color 0.2s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #CBA135;
            box-shadow: 0 0 0 2px rgba(203, 161, 53, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .submit-btn {
            background-color: #f5f5dc;
            color: #333;
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: background-color 0.2s ease;
        }

        .submit-btn:hover {
            background-color: #daa520;
            color: white;
        }

        .submit-btn:active {
            transform: translateY(1px);
        }

        .submit-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .output-section {
            margin-top: 20px;
        }

        .response-box {
            background-color: #f3f3f3;
            padding: 12px;
            border-radius: 8px;
            margin-top: 12px;
            white-space: pre-wrap;
            min-height: 60px;
            color: #333;
            line-height: 1.8;
        }

        .response-box.empty {
            color: #999;
            font-style: italic;
        }

        .loading {
            display: none;
            text-align: center;
            color: #666;
            font-style: italic;
        }

        .error {
            background-color: #fee;
            border: 1px solid #fcc;
            color: #c33;
            padding: 10px;
            border-radius: 8px;
            margin-top: 12px;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                padding: 12px;
            }
            
            .header h1 {
                font-size: 1.7rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”® å°ˆæ¥­æ˜Ÿåº§é¡§å•</h1>
            <p>è³‡æ·±å æ˜Ÿå¸«ã€Œæ˜Ÿè¾°è€å¸«ã€ï½œåŸºæ–¼å‚³çµ±å æ˜Ÿå­¸åŸç†çš„æ™ºæ…§è«®è©¢</p>
        </div>

        <form id="horoscopeForm" onsubmit="event.preventDefault(); send();">
            <div class="form-group">
                <label for="userName">ä½ çš„åå­—</label>
                <input type="text" id="userName" value="Yih Ven" required>
            </div>

            <div class="form-group">
                <label for="userSign">ä½ çš„æ˜Ÿåº§</label>
                <select id="userSign" required>
                    <option value="">è«‹é¸æ“‡æ˜Ÿåº§</option>
                    <option value="ç‰¡ç¾Šåº§">ç‰¡ç¾Šåº§ (3/21-4/19)</option>
                    <option value="é‡‘ç‰›åº§" selected>é‡‘ç‰›åº§ (4/20-5/20)</option>
                    <option value="é›™å­åº§">é›™å­åº§ (5/21-6/21)</option>
                    <option value="å·¨èŸ¹åº§">å·¨èŸ¹åº§ (6/22-7/22)</option>
                    <option value="ç…å­åº§">ç…å­åº§ (7/23-8/22)</option>
                    <option value="è™•å¥³åº§">è™•å¥³åº§ (8/23-9/22)</option>
                    <option value="å¤©ç§¤åº§">å¤©ç§¤åº§ (9/23-10/23)</option>
                    <option value="å¤©è åº§">å¤©è åº§ (10/24-11/22)</option>
                    <option value="å°„æ‰‹åº§">å°„æ‰‹åº§ (11/23-12/21)</option>
                    <option value="æ‘©ç¾¯åº§">æ‘©ç¾¯åº§ (12/22-1/19)</option>
                    <option value="æ°´ç“¶åº§">æ°´ç“¶åº§ (1/20-2/18)</option>
                    <option value="é›™é­šåº§">é›™é­šåº§ (2/19-3/20)</option>
                </select>
            </div>

            <div class="form-group">
                <label for="questionCategory">å•é¡Œé¡å‹</label>
                <select id="questionCategory">
                    <option value="">ä¸€èˆ¬è«®è©¢</option>
                    <option value="æ„Ÿæƒ…">ğŸ’• æ„Ÿæƒ…å•é¡Œ</option>
                    <option value="äº‹æ¥­">ğŸ’¼ äº‹æ¥­ç™¼å±•</option>
                    <option value="å¥åº·">ğŸƒ å¥åº·ç‹€æ³</option>
                    <option value="è²¡é‹">ğŸ’° è²¡é‹ç‹€æ³</option>
                    <option value="å­¸ç¿’">ğŸ“š å­¸ç¿’æˆé•·</option>
                </select>
            </div>

            <div class="form-group">
                <label for="userQuestion">ä½ çš„å•é¡Œ</label>
                <textarea id="userQuestion" placeholder="ä»Šå¤©æˆ‘æ‡‰è©²å°ˆæ³¨åœ¨ä»€éº¼äº‹æƒ…ä¸Šï¼Ÿè«‹è©³ç´°æè¿°ä½ çš„å…·é«”æƒ…æ³..." rows="4" required></textarea>
            </div>

            <div class="form-group">
                <label for="timeframe">è«®è©¢æ™‚é–“ç¯„åœ</label>
                <select id="timeframe">
                    <option value="ä»Šå¤©">ä»Šå¤©</option>
                    <option value="æœ¬é€±">æœ¬é€±</option>
                    <option value="æœ¬æœˆ">æœ¬æœˆ</option>
                </select>
            </div>

            <div class="form-group">
                <label for="birthDate">å‡ºç”Ÿæ—¥æœŸ (å¯é¸ï¼Œç”¨æ–¼æ›´ç²¾ç¢ºåˆ†æ)</label>
                <input type="date" id="birthDate">
            </div>

            <div class="form-group">
                <label for="mood">ç›®å‰å¿ƒæƒ…ç‹€æ…‹ (å¯é¸)</label>
                <input type="text" id="mood" placeholder="ä¾‹å¦‚ï¼šç„¦æ…®ã€èˆˆå¥®ã€å›°æƒ‘ã€å¹³éœ...">
            </div>

            <div class="form-group">
                <label for="partnerSign">ä¼´ä¾¶æ˜Ÿåº§ (æ„Ÿæƒ…å•é¡Œæ™‚å¯å¡«å¯«)</label>
                <select id="partnerSign">
                    <option value="">è«‹é¸æ“‡ä¼´ä¾¶æ˜Ÿåº§</option>
                    <option value="ç‰¡ç¾Šåº§">ç‰¡ç¾Šåº§ (3/21-4/19)</option>
                    <option value="é‡‘ç‰›åº§">é‡‘ç‰›åº§ (4/20-5/20)</option>
                    <option value="é›™å­åº§">é›™å­åº§ (5/21-6/21)</option>
                    <option value="å·¨èŸ¹åº§">å·¨èŸ¹åº§ (6/22-7/22)</option>
                    <option value="ç…å­åº§">ç…å­åº§ (7/23-8/22)</option>
                    <option value="è™•å¥³åº§">è™•å¥³åº§ (8/23-9/22)</option>
                    <option value="å¤©ç§¤åº§">å¤©ç§¤åº§ (9/23-10/23)</option>
                    <option value="å¤©è åº§">å¤©è åº§ (10/24-11/22)</option>
                    <option value="å°„æ‰‹åº§">å°„æ‰‹åº§ (11/23-12/21)</option>
                    <option value="æ‘©ç¾¯åº§">æ‘©ç¾¯åº§ (12/22-1/19)</option>
                    <option value="æ°´ç“¶åº§">æ°´ç“¶åº§ (1/20-2/18)</option>
                    <option value="é›™é­šåº§">é›™é­šåº§ (2/19-3/20)</option>
                </select>
            </div>

            <button type="submit" class="submit-btn" id="submitBtn">
                ğŸ”® é–‹å§‹å°ˆæ¥­å æ˜Ÿè«®è©¢
            </button>
        </form>

        <div class="output-section">
            <div class="loading" id="loading">
                ğŸ”® æ­£åœ¨ç‚ºä½ è§£è®€æ˜Ÿåº§é‹å‹¢...
            </div>
            <div class="response-box empty" id="responseBox">
                æ­¡è¿ä¾†åˆ°å°ˆæ¥­å æ˜Ÿè«®è©¢ï¼è«‹å¡«å¯«ä¸Šæ–¹è¡¨å–®ï¼Œæ˜Ÿè¾°è€å¸«å°‡æ ¹æ“šç•¶å‰å¤©è±¡ç‚ºæ‚¨æä¾›æ·±åº¦é‹å‹¢åˆ†æ
            </div>
        </div>
    </div>

    <script>
        async function send() {
            const submitBtn = document.getElementById('submitBtn');
            const loading = document.getElementById('loading');
            const responseBox = document.getElementById('responseBox');
            
            // å–å¾—è¡¨å–®è³‡æ–™
            const userName = document.getElementById('userName').value.trim();
            const userSign = document.getElementById('userSign').value;
            const userQuestion = document.getElementById('userQuestion').value.trim();
            const questionCategory = document.getElementById('questionCategory').value;
            const timeframe = document.getElementById('timeframe').value;
            const birthDate = document.getElementById('birthDate').value;
            const mood = document.getElementById('mood').value.trim();
            const partnerSign = document.getElementById('partnerSign').value;
            
            // é©—è­‰è¼¸å…¥
            if (!userName || !userSign || !userQuestion) {
                alert('è«‹å¡«å¯«å§“åã€æ˜Ÿåº§å’Œå•é¡Œï¼');
                return;
            }
            
            // è¨­å®šè¼‰å…¥ç‹€æ…‹
            submitBtn.disabled = true;
            submitBtn.textContent = 'ğŸ”® æ˜Ÿè¾°è€å¸«è«®è©¢ä¸­...';
            loading.style.display = 'block';
            loading.textContent = 'ğŸŒŸ æ­£åœ¨çµåˆç•¶å‰å¤©è±¡ç‚ºæ‚¨é€²è¡Œæ·±åº¦å æ˜Ÿåˆ†æ...';
            responseBox.className = 'response-box empty';
            responseBox.textContent = '';
            
            // æº–å‚™è«‹æ±‚è³‡æ–™
            const requestData = {
                user: userName,
                sign: userSign,
                question: userQuestion,
                category: questionCategory || null,
                timeframe: timeframe,
                birth_date: birthDate || null,
                mood: mood || null,
                partner_sign: partnerSign || null
            };
            
            try {
                // ç™¼é€è«‹æ±‚åˆ°å¾Œç«¯API
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                // é¡¯ç¤ºå¢å¼·çš„å›æ‡‰å…§å®¹
                responseBox.className = 'response-box';
                
                let displayText = data.reply || 'æŠ±æ­‰ï¼Œç„¡æ³•å–å¾—æ˜Ÿåº§å»ºè­°ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚';
                
                // æ·»åŠ å æ˜Ÿå­¸æ´å¯Ÿ
                if (data.astrological_insight) {
                    displayText += '\n\nğŸŒŸ å æ˜Ÿå­¸æ´å¯Ÿï¼š\n';
                    displayText += `ğŸª è¡Œæ˜Ÿå½±éŸ¿ï¼š${data.astrological_insight.current_planetary_influence}\n`;
                    displayText += `ğŸŒ™ æœˆç›¸èƒ½é‡ï¼š${data.astrological_insight.lunar_phase_effect}\n`;
                    displayText += `ğŸ‚ å­£ç¯€æŒ‡å°ï¼š${data.astrological_insight.seasonal_energy}\n`;
                    displayText += `âš¡ å…ƒç´ å»ºè­°ï¼š${data.astrological_insight.element_guidance}`;
                }
                
                // æ·»åŠ æ™‚æ©ŸæŒ‡å°
                if (data.timing_advice) {
                    displayText += '\n\nâ° æœ€ä½³æ™‚æ©Ÿï¼š\n' + data.timing_advice;
                }
                
                // æ·»åŠ å¯¦ç”¨å»ºè­°
                if (data.tips && data.tips.length > 0) {
                    displayText += '\n\nğŸ’ å°ˆæ¥­å»ºè­°ï¼š\n';
                    data.tips.forEach((tip, index) => {
                        displayText += `${index + 1}. ${tip}\n`;
                    });
                }
                
                // æ·»åŠ æ­£é¢è‚¯å®šèª
                if (data.affirmation) {
                    displayText += '\nâœ¨ èƒ½é‡ç¥ç¦ï¼š\n' + data.affirmation;
                }
                
                // æ·»åŠ å¹¸é‹å…ƒç´ 
                if (data.lucky_elements) {
                    displayText += '\n\nğŸ€ ä»Šæ—¥å¹¸é‹å…ƒç´ ï¼š\n';
                    displayText += `ğŸ¨ å¹¸é‹è‰²å½©ï¼š${data.lucky_elements.color}\n`;
                    displayText += `ğŸ”¢ å¹¸é‹æ•¸å­—ï¼š${data.lucky_elements.number}\n`;
                    displayText += `ğŸ§­ å¹¸é‹æ–¹ä½ï¼š${data.lucky_elements.direction}\n`;
                    displayText += `â° å¹¸é‹æ™‚æ®µï¼š${data.lucky_elements.time}`;
                }
                
                // æ·»åŠ ç›¸å®¹æ€§åˆ†æ
                if (data.compatibility_score && partnerSign) {
                    displayText += '\n\nğŸ’• æ„Ÿæƒ…ç›¸å®¹æ€§åˆ†æï¼š\n';
                    displayText += `èˆ‡${partnerSign}çš„ç›¸å®¹æŒ‡æ•¸ï¼š${data.compatibility_score}%`;
                    
                    let compatibilityLevel = '';
                    if (data.compatibility_score >= 80) compatibilityLevel = 'âœ¨ æ¥µä½³é…å°';
                    else if (data.compatibility_score >= 65) compatibilityLevel = 'ğŸ’– å¾ˆå¥½é…å°';
                    else if (data.compatibility_score >= 50) compatibilityLevel = 'ğŸ’« ä¸­ç­‰é…å°';
                    else compatibilityLevel = 'ğŸ’ª éœ€è¦åŠªåŠ›';
                    
                    displayText += ` (${compatibilityLevel})`;
                }
                
                responseBox.textContent = displayText;
                
            } catch (error) {
                console.error('è«‹æ±‚å¤±æ•—:', error);
                responseBox.className = 'response-box error';
                responseBox.textContent = `é€£ç·šéŒ¯èª¤ï¼š${error.message}\n\nè«‹ç¢ºèªå¾Œç«¯ä¼ºæœå™¨æ˜¯å¦æ­£åœ¨é‹è¡Œï¼Œä¸¦é‡æ–°å˜—è©¦ã€‚`;
            } finally {
                // æ¢å¾©æŒ‰éˆ•ç‹€æ…‹
                submitBtn.disabled = false;
                submitBtn.textContent = 'ğŸ”® é–‹å§‹å°ˆæ¥­å æ˜Ÿè«®è©¢';
                loading.style.display = 'none';
            }
        }
        
        // æŒ‰ Enter éµæäº¤ï¼ˆåœ¨ textarea ä¸­æŒ‰ Shift+Enter æ›è¡Œï¼‰
        document.getElementById('userQuestion').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                send();
            }
        });
        
        // é é¢è¼‰å…¥å®Œæˆå¾Œèšç„¦åˆ°å•é¡Œè¼¸å…¥æ¡†
        window.addEventListener('load', function() {
            document.getElementById('userQuestion').focus();
        });
    </script>
</body>
</html>